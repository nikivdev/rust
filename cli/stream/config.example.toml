# Example configuration for the `stream` CLI.
# Copy this file to ~/.config/stream/config.toml and customize the values.

default_profile = "main"

[profiles.main]
description = "Primary monitor streamed over SRT to ffmpeg on the Linux ingest box."

[profiles.main.remote]
host = "stream-box.local"
user = "stream"
port = 22
tmux_session = "streamd"
ingest_port = 6000
packet_size = 1316
log_path = "/home/stream/logs/streamd.log"

[profiles.main.remote.runner]
type = "ffmpeg"
output = "/home/stream/recordings/current.ts"
format = "mpegts"
copy_video = true
copy_audio = true
extra_args = ["-map", "0:v:0", "-map", "0:a?", "-flush_packets", "1"]

[profiles.main.local]
ffmpeg_path = "/opt/homebrew/bin/ffmpeg"
fps = 60
video_bitrate = "9000k"
maxrate = "9000k"
bufsize = "18000k"
audio_bitrate = "192k"
scale_filter = "scale=-2:1440:flags=lanczos"
filters = ["format=yuv420p"]
extra_args = ["-vsync", "1", "-color_range", "pc"]
# Process priority: 10 = low priority (default), 19 = lowest (zero-impact)
nice = 10
# Fast startup: minimal probing for known capture source
probesize = 32
analyzeduration = 0

[profiles.main.local.capture]
type = "avfoundation"
video_device = "1"
audio_device = "0"
pixel_format = "uyvy422"
capture_cursor = true
capture_clicks = true
thread_queue_size = 4096

[profiles.main.local.encoder]
type = "h264_videotoolbox"
quality = "Quality"
allow_sw = false

[profiles.main.local.transport]
type = "srt"
latency_ms = 20
packet_size = 1316

[profiles.obs]
description = "Headless OBS on the remote server (must reference an SRT media source listening on the same ingest_port)."

[profiles.obs.remote]
host = "stream-box.local"
user = "stream"
tmux_session = "stream-obs"
ingest_port = 6000
packet_size = 1316

[profiles.obs.remote.runner]
type = "headless_obs"
binary = "/usr/bin/obs"
profile = "Headless"
scene_collection = "SRT"
xvfb = true
extra_args = ["--websocket_port", "59650"]

[profiles.obs.remote.runner.env]
OBS_USE_EGL = "1"

[profiles.obs.local]
ffmpeg_path = "/opt/homebrew/bin/ffmpeg"
fps = 60
video_bitrate = "12000k"
maxrate = "12000k"
bufsize = "24000k"
scale_filter = "scale=-2:2160:flags=lanczos"
filters = ["format=yuv420p"]

[profiles.obs.local.capture]
type = "avfoundation"
video_device = "1"
audio_device = "none"
pixel_format = "uyvy422"
capture_cursor = false
capture_clicks = false

[profiles.obs.local.encoder]
type = "hevc_videotoolbox"
quality = "Quality"
allow_sw = false

[profiles.obs.local.transport]
type = "srt"
latency_ms = 30
packet_size = 1316

# Zero-impact profile: designed for absolutely no performance impact on the host system.
# Uses lowest process priority, hardware encoding only, and minimal CPU overhead.
[profiles.zero-impact]
description = "Zero-impact streaming: lowest priority, hardware encoding, no perceptible system impact."

[profiles.zero-impact.remote]
host = "stream-box.local"
user = "stream"
tmux_session = "streamd"
ingest_port = 6000
packet_size = 1316

[profiles.zero-impact.remote.runner]
type = "ffmpeg"
output = "/home/stream/recordings/current.ts"
format = "mpegts"
copy_video = true
copy_audio = true

[profiles.zero-impact.local]
ffmpeg_path = "/opt/homebrew/bin/ffmpeg"
fps = 60
# Moderate bitrate - good quality without excessive bandwidth
video_bitrate = "6000k"
maxrate = "8000k"
bufsize = "12000k"
audio_bitrate = "128k"
# No scaling = zero CPU for video processing
# If you need scaling, use VideoToolbox: scale_filter = "scale_vt=-2:1080"
# Process priority: 19 = lowest possible (idle priority)
nice = 19
# Instant startup
probesize = 32
analyzeduration = 0

[profiles.zero-impact.local.capture]
type = "avfoundation"
video_device = "1"
audio_device = "none"
pixel_format = "uyvy422"
capture_cursor = true
capture_clicks = false
thread_queue_size = 512

[profiles.zero-impact.local.encoder]
# VideoToolbox = 100% hardware encoding via Apple Silicon GPU
# Uses dedicated media engine, zero CPU impact
type = "h264_videotoolbox"
# "Speed" = faster encoding, less compute, slightly larger files
# "Quality" = better compression but more GPU work
quality = "Speed"
# Never fall back to software encoding
allow_sw = false

[profiles.zero-impact.local.transport]
type = "srt"
# Lower latency = less buffering overhead
latency_ms = 20
packet_size = 1316
